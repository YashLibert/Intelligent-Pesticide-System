<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Intelligent Pesticide System Dashboard</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="AI-powered plant health monitoring, precision spraying control, and blockchain traceability.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="dashb.css"> 
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="brand">
                <div class="logo">üß†</div>
                <div>
                    <h1>Intelligent Pesticide System</h1>
                    <div class="small text-gradient">Agentic AI ‚Ä¢ Precision Spraying ‚Ä¢ Immutable Ledger</div>
                </div>
            </div>
            <div class="row">
                <button id="logoutBtn" class="button alt">Logout</button>
            </div>
        </header>

        <div id="dash_msg"></div>

        <main id="dashboard-root">
            <div class="grid cols-4">
                <div class="stat-card stat-visual">
                    <div class="stat-label">Pesticide Saved (L)</div>
                    <div class="stat-value" id="stat_saved_l">45.8</div>
                </div>
                <div class="stat-card stat-visual">
                    <div class="stat-label">Detection Accuracy (%)</div>
                    <div class="stat-value" id="stat_accuracy">98.1</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Blocks</div>
                    <div class="stat-value" id="stat_block_height">1,402</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üí∞ ECO-REWARDS</div>
                    <div class="stat-value pulse" id="reward_total">12,450</div>
                </div>
            </div>

            <div style="height:32px"></div>
            
            <div class="grid cols-2 main-dash-grid"> 
                
                <article class="card">
                    <h3>üß† AI Detection & Upload</h3>
                    <p class="small">Upload an image or use a stream URL to run a new diagnostic cycle.</p>

                    <form id="detectForm">
                        <label>üì∑ Camera Stream URL</label>
                        <input id="detect_imageUrl" type="text" placeholder="http://192.168.1.10/stream">

                        <label>üìÅ Or Upload Image</label>
                        <input id="detect_file" type="file" accept="image/*">
                        
                        <div id="image_preview" class="image-preview-container" style="display:none;">
                            <img id="preview_img" class="image-preview" alt="Preview">
                        </div>

                        <button class="button" type="submit" id="detectBtn">
                            ‚ö° Run AI Detection
                        </button>
                    </form>

                    <div id="detect_result" style="margin-top:24px; padding-top: 16px; border-top: 1px solid rgba(255, 255, 255, 0.05);">
                        <div class="small" style="color: var(--text-muted);">Top diagnosis will appear here after detection.</div>
                    </div>
                </article>
                
                <article class="card">
                    <h3>üìä AI Confidence Breakdown</h3>
                    <p class="small">Visualization of model prediction scores across all potential diseases.</p>
                    <div style="padding: 10px 0;">
                        <div style="height: 250px;"><canvas id="aiConfidenceChart"></canvas></div>
                        <div id="chart_placeholder" class="small" style="text-align:center; color: var(--text-muted); margin-top: 20px;">
                            No data available. Run detection to populate chart.
                        </div>
                    </div>
                </article>

                <article class="card">
                    <h4 style="font-size: 16px; margin-top: 0; color: var(--accent-green);">Automated Record Keeping</h4>
                    <p class="small">Log the diagnostic results as a new spray event on the ledger.</p>
                    <form id="recordForm" style="margin-top: 16px;">
                        <label>üå± Plant ID (Optional)</label>
                        <input id="record_plantId" type="text" placeholder="e.g., PLT-001">
                        
                        <label>üîó Last AI Transaction ID</label>
                        <input id="record_ai_tx" type="text" placeholder="TXN-AI-82F3X" value="TXN-AI-82F3X" readonly>

                        <div class="row" style="gap: 16px;">
                            <div style="flex-grow: 1;">
                                <label>ü¶† Confirmed Disease</label>
                                <input id="record_disease" type="text" placeholder="e.g., Leaf Blight">
                            </div>
                            <div style="flex-basis: 100px;">
                                <label>üìà Infection (%)</label>
                                <input id="record_infection" type="number" min="0" max="100" placeholder="0-100">
                            </div>
                        </div>
                        
                        <label>üß™ Pesticide Dose (ml)</label>
                        <input id="record_amount" type="number" min="0" placeholder="e.g., 15" required>

                        <button class="button" type="submit" style="background: var(--accent-green); box-shadow: 0 0 15px var(--success-glow);">
                            ‚úçÔ∏è Commit to Ledger
                        </button>
                    </form>
                </article>

                <article class="card">
                    <h3>‚õìÔ∏è Recent Ledger Commits</h3>
                    <p class="small">Immutable, verifiable proof of application.</p>
                    
                    <div id="ledger_area" class="small">
                        <table class="table ledger-table">
                            <thead>
                                <tr>
                                    <th>Block</th>
                                    <th>Time</th>
                                    <th>Dose (ml)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><div class="data-chip">#1403</div></td><td>Just now</td><td>15</td></tr>
                                <tr><td><div class="data-chip">#1402</div></td><td>10m ago</td><td>22</td></tr>
                                <tr><td><div class="data-chip">#1401</div></td><td>35m ago</td><td>0 (Healthy)</td></tr>
                                <tr><td><div class="data-chip">#1400</div></td><td>1h ago</td><td>18</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h4 style="font-size: 16px; margin-top: 24px; color: var(--accent-cyan);">Spray History Log</h4>
                    <p class="small">Full history of spray events from the device.</p>
                    <div id="spray_history" style="height: 250px;">
                        <pre style="white-space:pre-wrap; color: var(--text-secondary);">
[
  {
    "time": "2025-10-13T10:00:00Z",
    "disease": "Leaf Blight",
    "dose": 15
  },
  // ... more logs
]
                        </pre>
                    </div>
                </article>
            </div>
        </main>

        <footer class="footer">
            <div class="small">
                üåæ Intelligent Pesticide System | Powered by AI & Blockchain<br>
                Real-time disease detection ‚Ä¢ Precision agriculture ‚Ä¢ Transparent tracking
            </div>
            
        </footer>
    </div>
    <script src="app.js"></script>
    </body>
</html>